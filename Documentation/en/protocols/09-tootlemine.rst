..  IVXV protocols

==========================
Processing the Ballot box
==========================


Revocation and Restoration List
---------------------------------

The revocation and restoration list contains data on persons whose e-vote needs
to be revoked (will not be counted when calculating the voting results) or
restored (i.e. the previous revocation is cancelled and the restored e-vote is
taken into consideration when votes are recounted). The list is uploaded into
the system as a digitally signed document in the following data file format:

.. literalinclude:: ../../common/schema/ivxv.revoke.schema
   :language: json
   :linenos:

Example:

.. literalinclude:: ../../common/schema/ivxv.revoke.schema.example
   :language: json


List of i-voters
----------------------

The list of i-voters is a list of people who have cast their vote online, issued
after the end of e-voting and sorted by polling stations. The document is
generated by the processing application.

.. literalinclude:: ../../common/schema/ivxv.voterlist.schema
   :language: json
   :linenos:


Example:

.. literalinclude:: ../../common/schema/ivxv.voterlist.schema.example
   :language: json


Voting Result
-----------------

The votes, decrypted by the key application and summed up, sorted by electoral
districts and polling stations.

The voting result file has to contain the following data for every polling
station.

#. An entry that shows the number of spoilt and invalid votes. If there were no
   spoilt or invalid votes in the polling station, the number of votes is zero

#. An entry that shows the number of votes given in favor of each choice. If no
   votes were cast in favor of a choice in the polling station, the number of
   votes is zero

.. literalinclude:: ../../common/schema/ivxv.result.schema
   :language: json
   :linenos:

Example:

.. literalinclude:: ../../common/schema/ivxv.result.schema.example
   :language: json



Ballot box
-----------

The file contains the votes received by the collector service along with the
data accompanying the votes.

The file is in Zip64 container format.

The voter-specific folders are located immediately under a `votes` root
directory.


File contents:

* :file:`votes/<voter id>/`

 * :file:`<timestamp>.version`

 * :file:`<timestamp>.<vote type>`

 * :file:`<timestamp>.<qualifier>*`

where:

* ``<voter id>`` is the voter’s identifier; in case of Estonia it is a personal
  identification code

* ``<timestamp>`` is the time of presenting the vote in the format
  ``yyyymmddhhmmssmmm±zzzz``;

  * this is the moment when the request was sent to the collector service, and
    is simply given to improve the human-readability of the urn; the actual
    timestamp of the vote is inside one of the qualifying responses

* ``<vote type>`` is the choice container type; in case of Estonia it is BDOC

  * BDOC itself has a basic profile and does not contain any qualifying
    parameters (validity certifications, timestamps, etc.)

* ``<qualifier>`` is the type of vote-qualifying protocol; the following are
  currently possible:

   * ``ocsp`` - *Online Certificate Status Protocol* (validity certificate, `RFC
     6960 <https://tools.ietf.org/html/rfc6960>`_) confirms that the voter’s
     signing certificate was valid at the moment of voting

   * ``ocsptm`` - the same as ``ocsp``, but uses the `BDOC
     <http://www.id.ee/public/bdoc-spec212-est.pdf>`_ specification extension
     specified in Section 6.1, where the nonce is the vote signature hash in
     order to timestamp the vote

   * ``tsp`` - *Time-Stamp Protocol* (timestamp, `RFC 3161
     <https://tools.ietf.org/html/rfc3161>`_), which confirms that at the time
     of making the request the vote existed

   * ``tspreg`` - the same as ``tsp``, but the nonce is the collector service
     signature on the request ``MessageImprint`` element to register the vote

* The files that exist for each vote are:

   * ``<timestamp>.version`` - the version of the voter list that was valid at
     the moment the vote was cast

   * ``<timestamp>.<vote type>`` - the choice container that includes the choice
     identifier in ``<valimise id>.<küsimuse id>.ballot`` form.  In case of
     Estonia, the relevantly named file in the BDOC container

   * ``<timestamp>.<qualifier>`` - response to the vote-qualifying protocol
     request; there can be several, but no more than one for each protocol



Anonymized ballot box
-----------------------

Encrypted votes grouped by election districts and stations.
Anonymized ballot box does not contain voter information.

The anonymized ballot box is the output of the processing application and input
for the decryption application.


.. literalinclude:: ../../common/schema/ivxv.anon-bb.schema
   :language: json
   :linenos:

Example:

.. literalinclude:: ../../common/schema/ivxv.anon-bb.schema.example
   :language: json
